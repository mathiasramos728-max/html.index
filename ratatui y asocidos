<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Calculadora Cursed</title>

<style>
:root{--bg:#0f172a;--card:#0b1220;--accent:#7c3aed;--btn:#e6e7ee}
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg,#071024 0%, #09203a 100%);font-family:Arial;color:#e6eef8;
}
.container{
  width:340px;background:var(--card);border-radius:14px;padding:18px;
  box-shadow:0 8px 30px rgba(2,6,23,0.7);position:relative;overflow:hidden;
}
.display{
  height:72px;background:rgba(255,255,255,0.03);border-radius:10px;padding:10px 12px;
  display:flex;flex-direction:column;justify-content:center;align-items:flex-end;overflow:hidden;
}
.expr{font-size:14px;color:rgba(230,238,248,0.6);white-space:nowrap;text-overflow:ellipsis;overflow:hidden;width:100%}
.value{font-size:26px;font-weight:600;margin-top:4px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:14px}
button{height:54px;border-radius:10px;border:0;background:rgba(255,255,255,0.07);color:var(--btn);font-size:18px;cursor:pointer}
button:active{transform:translateY(1px)}
.op{background:transparent;color:var(--accent);border:1px solid rgba(124,58,237,0.18)}
.danger{background:rgba(220,38,38,0.12);color:#ff9b9b}
.wide{grid-column:span 2}

/* EFECTO ROTURA */
.break-screen{
  position:absolute;inset:0;background:#000;display:flex;flex-direction:column;
  justify-content:center;align-items:center;font-size:22px;font-weight:700;
  color:#ffcece;text-align:center;padding:15px;z-index:999;opacity:0;pointer-events:none;
  animation:explode 1s forwards;transform:scale(0);
}
#repairBtn{
  margin-top:20px;padding:10px 20px;font-size:16px;border-radius:8px;border:0;
  cursor:pointer;background:#7c3aed;color:white;
}
@keyframes explode{
  0%{opacity:0;transform:scale(0.2);filter:brightness(3);}
  50%{opacity:1;transform:scale(1.3);filter:brightness(4);}
  100%{opacity:1;transform:scale(1);filter:brightness(1);}
}
.crack{
  animation:crackAnim 0.4s ease forwards;
}
@keyframes crackAnim{
  0%{filter:brightness(1);transform:scale(1);}
  50%{filter:brightness(0.5);transform:scale(0.95) rotate(-2deg);}
  100%{filter:brightness(0.2);transform:scale(0.8) rotate(3deg);}
}
</style>

</head>
<body>

<div class="container" role="application">
  <div class="display">
    <div class="expr" id="expression">0</div>
    <div class="value" id="value">0</div>
  </div>

  <div class="grid" id="keys">
    <button class="danger" data-action="clear">C</button>
    <button data-action="neg">±</button>
    <button data-action="percent">%</button>
    <button class="op" data-action="op">÷</button>

    <button data-num="7">7</button><button data-num="8">8</button><button data-num="9">9</button><button class="op" data-action="op">×</button>
    <button data-num="4">4</button><button data-num="5">5</button><button data-num="6">6</button><button class="op" data-action="op">−</button>
    <button data-num="1">1</button><button data-num="2">2</button><button data-num="3">3</button><button class="op" data-action="op">+</button>
    <button data-num="0" class="wide">0</button><button data-num=".">.</button><button class="op" data-action="equals">=</button>
  </div>
</div>

<!-- PANTALLA ROTA -->
<div id="broken" class="break-screen" style="display:none;">
  Viste rompiste mi calculadora,<br>me la pagas
  <button id="repairBtn">Pagar reparación</button>
</div>

<script>
let expr='', current='0', lastWasOp=false;
const expressionEl=document.getElementById('expression');
const valueEl=document.getElementById('value');
function refresh(){expressionEl.textContent=expr||'0';valueEl.textContent=current;}

function inputNumber(d){
  if(lastWasOp){current=d==='.'?'0.':d;lastWasOp=false;}
  else if(current==='0' && d!=='.') current=d;
  else if(current.includes('.') && d==='.') return;
  else current+=d;
  refresh();
}
function inputOp(op){
  if(lastWasOp){expr=expr.slice(0,-1)+op;}
  else{expr=expr?expr+current+op:current+op;current='0';}
  lastWasOp=true;refresh();
}
function clearAll(){expr='';current='0';lastWasOp=false;refresh();}
function toggleNeg(){if(current==='0')return;current=current.startsWith('-')?current.slice(1):'-'+current;refresh();}
function percent(){current=String(Number(current)/100);refresh();}

function evaluate(){
  if(lastWasOp) expr=expr.slice(0,-1);
  const toEval=(expr||'')+current;
  try{
    const safe=toEval.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-');
    if(!/^[0-9+\\-*/.() ]+$/.test(safe)) throw new Error();
    const result=Function('return ('+safe+');')();
    current=Number.isFinite(result)?String(result):'Error';
    if(current!=='Error') current+='  coma mierda';
    expr='';lastWasOp=false;
  }catch(e){current='Error';expr='';lastWasOp=false;}
  refresh();

  // ROMPER ANIMACIÓN
  setTimeout(()=>document.querySelector('.container').classList.add('crack'),200);
  setTimeout(()=>{
    document.getElementById('broken').style.display='flex';
    document.getElementById('broken').style.pointerEvents='all';
  },800);
  setTimeout(()=>document.getElementById('keys').style.pointerEvents='none',900);
}

// BOTONES
document.querySelectorAll('button').forEach(btn=>{
  const num=btn.getAttribute('data-num');
  const action=btn.getAttribute('data-action');
  btn.onclick=()=>{
    if(num!==null) inputNumber(num);
    else if(action==='clear') clearAll();
    else if(action==='neg') toggleNeg();
    else if(action==='percent') percent();
    else if(action==='op') inputOp(btn.textContent.trim());
    else if(action==='equals') evaluate();
  };
});

// REPARAR
document.getElementById('repairBtn').onclick=()=>{
  document.getElementById('broken').style.display="none";
  document.querySelector('.container').classList.remove('crack');
  document.getElementById('keys').style.pointerEvents='all';
  clearAll();
};
refresh();
</script>

</body>
</html>
